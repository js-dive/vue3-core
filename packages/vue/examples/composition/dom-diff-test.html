<script src="../../dist/vue.global.js"></script>

<div id="app">
</div>

<script>
  const { h, defineComponent, computed, ref, watch, onMounted, onUpdated } = Vue

  Vue.createApp({
    components: {
    },
    setup() {
      const vnode = ref({
        tag: 'div',
        children: [
          { tag: 'div', children: ['a'], key: 0 },
          { tag: 'div', children: ['b'], key: 1 },
          { tag: 'div', children: ['c'], key: 2 },
          { tag: 'div', children: ['d'], key: 3 },
          { tag: 'div', children: ['e'], key: 4 },
          { tag: 'div', children: ['f'], key: 5 },
          { tag: 'div', children: ['g'], key: 6 }
        ]
      })

      setTimeout(() => {
        vnode.value = {
          tag: 'div',
          children: [
            { tag: 'div', children: ['a'], key: 0 },
            { tag: 'div', children: ['b'], key: 1 },
            { tag: 'div', children: ['e'], key: 4 },
            { tag: 'div', children: ['d'], key: 3 },
            { tag: 'div', children: ['h'], key: 7 },
            { tag: 'div', children: ['i'], key: 8 },
            { tag: 'div', children: ['c'], key: 2 },
            { tag: 'div', children: ['f'], key: 5 },
            { tag: 'div', children: ['g'], key: 6 }
          ]
        }
      }, 2000)

      onUpdated(() => {
        console.log('视图更新')
      })

      return () => {
        return h(
          vnode.value.tag,
          {},
          vnode.value.children.map(
            it => h(
              it.tag,
              {
                key: it.key
              },
              [...(it.children ?? [])]
            )
          )
        )
      }
    }
  })
    .mount('#app')
</script>
